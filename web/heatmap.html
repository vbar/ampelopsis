<!-- based on code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">
<title>TÃ©mata</title>

<script src="https://d3js.org/d3.v4.js"></script>

<div id="the_graph"></div>
<div id="footer"></div>

<script>

var margin = {top: 15, right: 15, bottom: 15, left: 15},
    width = 1200 - margin.left - margin.right,
    height = 800 - margin.top - margin.bottom;

var svg = d3.select("#the_graph")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform",
	  "translate(" + margin.left + "," + margin.top + ")");

d3.json("heatmap.json",
    function (metadata) {
	var dateParse = d3.timeParse("%Y-%m-%dT%H:%M:%S%Z"),
	    dateFormat = d3.timeFormat('%-d.%-m.%Y'),
	    dateExtent = [ dateParse(metadata.dateExtent[0]), dateParse(metadata.dateExtent[1]) ],
	    footer = document.getElementById('footer');
	footer.innerHTML = dateFormat(dateExtent[0]) + " - " + dateFormat(dateExtent[1]);

	var x = d3.scaleBand()
	    .range([ 0, width ])
	    .domain(d3.range(0, metadata.colDesc.length, 1))
	    .padding(0.01);

	var y = d3.scaleBand()
	    .range([ height, 0 ])
	    .domain(d3.range(0, metadata.rowDesc.length, 1))
	    .padding(0.01);

	var palette = d3.scaleLinear()
	    .range(["white", "black"])
	    .domain([0, metadata.maxValue])

	svg.selectAll()
	    .data(metadata.table)
	    .enter()
	    .append("rect")
	    .attr("x", function (d) { return x(d[1]); })
	    .attr("y", function (d) { return y(d[0]); })
	    .attr("width", x.bandwidth() )
	    .attr("height", y.bandwidth() )
	    .style("fill", function (d) { return palette(d[2]); } )
	    .on("click", function (d) {
		if (d3.event.defaultPrevented) return;
		window.open(metadata.rowDesc[d[0]]);
	    })
	    .append("title").text(function (d) {
		return metadata.colDesc[d[1]];
	    });
    });

</script>
