<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hashtagy</title>
    <style>

table {
    margin-bottom: 10px;
}

span {
    cursor: pointer;
}

    </style>
    <script src="https://d3js.org/d3.v4.js"></script>
  </head>
  <body>
    <table id="the_table"></table>
    <div id="footer"></div>
    <script>

d3.json("table.json", function (metadata) {
    var dateParse = d3.timeParse("%Y-%m-%d"),
	dateFormat = d3.timeFormat("%-d.%-m.%Y"),
	path2idx = {},
	dateExtent = [ dateParse(metadata.dateExtent[0]), dateParse(metadata.dateExtent[1]) ],
	table = d3.select("#the_table"),
	tr = table.selectAll("tr")
	.data(metadata.data)
	.enter()
	.append("tr");

	footer = document.getElementById('footer');
	footer.innerHTML = dateFormat(dateExtent[0]) + " - " + dateFormat(dateExtent[1]);

    tr.append("td")
	.text(function (d) { return d.name; })
	.style("color", function (d) { return d.color; });

    tr.append("td")
	.selectAll("span")
	.data(function (d) { return d.terms; })
	.enter()
	.append("span")
	.text(function (d) { return d[0]; })
	.on("click", function (d, i) {
	    if (d3.event.defaultPrevented) return;

	    var row = d3.select(this.parentNode.parentNode).datum(),
		samples = row.samples[i],
		major = row.name,
		minor = d[0],
		minor2idx = path2idx[major],
		idx;

	    if (!minor2idx) {
		minor2idx = {};
		path2idx[major] = minor2idx;
	    }

	    idx = minor2idx[minor] || 0;

	    window.open(samples[idx]);

	    idx += 1;
	    if (idx >= samples.length) {
		idx = 0;
	    }

	    minor2idx[minor] = idx;
	})
	.attr("title", function (d) {
	    var freq = d[1],
		tail = (freq == 1) ? "výskyt" : (((freq > 1) && (freq < 5)) ? "výskyty" : "výskytů");

	    return freq + " " + tail;
	})
	.append("span")
	.text(" ");
});

    </script>
  </body>
</html>
